#!/usr/bin/make -f

clean:
	dh_testdir
	dh_testroot
	dh_clean *.pyc

build:

install: build
	dh_testdir
	dh_testroot
	dh_prep
	dh_install r2e usr/bin
	dh_install html2text.py rss2email.py usr/share/rss2email
	chmod 644 debian/rss2email/usr/share/rss2email/*
	perl -i -pe 's/\r//' debian/rss2email/usr/share/rss2email/*

binary-indep: build install
	dh_testdir
	dh_testroot
	dh_installchangelogs
	dh_installdocs
	dh_installexamples config.py.example
	dh_installman r2e.1
	dh_compress
	dh_fixperms
	chmod 644 debian/rss2email/usr/share/doc/rss2email/examples/config.py.example
	dh_pysupport
	dh_installdeb
	dh_gencontrol
	dh_md5sums
	dh_builddeb

binary-arch: build install

binary: binary-indep binary-arch

DEB_UPSTREAM_VERSION=$(shell dpkg-parsechangelog | sed -rne 's,^Version: ([0-9]+:)?([^-]+).*,\2,p')
get-orig-source:
	uscan --noconf --force-download --rename --download-current-version --destdir=.
	tar xzf rss2email_$(DEB_UPSTREAM_VERSION).orig.tar.gz
	rm rss2email_$(DEB_UPSTREAM_VERSION).orig.tar.gz
	chmod -R +rwx rss2email-$(DEB_UPSTREAM_VERSION)
	mv rss2email-$(DEB_UPSTREAM_VERSION) rss2email-$(DEB_UPSTREAM_VERSION).orig
	GZIP=--best tar -cz --owner root --group root --mode a+rX \
                        -f rss2email_$(DEB_UPSTREAM_VERSION).orig.tar.gz \
                        rss2email-$(DEB_UPSTREAM_VERSION).orig
	rm -r rss2email-$(DEB_UPSTREAM_VERSION).orig

.PHONY: build clean binary-indep binary-arch binary install get-orig-source
